<!doctype html>
<html>
<head>
<title>Reactive Programming with Components</title>
<link rel="stylesheet" href="/unbundled/_styles/prism.css">
<link rel="stylesheet" href="/unbundled/_styles/theme.css">

<script type="module">// module Kram_d693e88c_reactive (ES6)
          import { register } from "/_scripts/oper.ative.js"
          
          console.log('Loading module "Kram_d693e88c_reactive"')
          export function Program ({connectStore, initializeStore}) {
            // JS Definition from scene 1
class FrpMain extends HTMLElement {
  constructor(init = {}, update = FrpMain.update, msgType = {}) {
    super();
    let content = document.getElementById("frp-main-template").content;
    this.attachShadow({ mode: "open" }).appendChild(content.cloneNode(true));
    this._model = createObservable(this, init);
    this._messageType = msgType;
    this._update = update;
    this.dataset["frpMain"] = name;

    console.log("frp-main constructed ", this._model);
  }

  connectedCallback() {}

  // used by descendants to find their main
  static closest(element) {
    return element.closest("[data-frp-main]");
  }

  static whenObservableFrom(element) {
    const available = element.closest("[data-frp-main]");

    if (available) {
      return Promise.resolve({
        model: available.model,
        attach: available.attachObserver.bind(available),
      });
    }

    return new Promise((resolve, reject) => {
      // search for the closest undefined parent
      let candidate = element.closest(":not(:defined)");

      if (candidate) {
        // wait for the blocking element to be defined,
        // and then upgrade it when it is.
        customElements.whenDefined(candidate.localName).then(() => {
          if (candidate instanceof FrpMain) {
            resolve({
              model: candidate.model,
              attach: candidate.attachObserver.bind(candidate),
            });
          } else {
            // should continue up the tree, but for now, reject.
            reject({
              error: `Found ${candidate.localName}, but it is not FrpMain`,
              candidate,
            });
          }
        });
      } else {
        throw "No candidates found for frp-main element";
      }
    });
  }

  attachObserver(update) {
    console.log("Setting up event listener for observer.update", this);
    this.addEventListener("observable:change", () => update(this.model));
  }

  // main provides the model (readonly)
  get model() {
    return this._model;
  }

  get messageType() {
    return this._messageType;
  }

  bind(fn) {
    return new Promise((resolve, reject) => {
      try {
        const action = fn(this.dispatch.bind(this), this.messageType);

        resolve(action);
      } catch (error) {
        reject(error);
      }
    });
  }

  dispatch(action) {
    console.log("frp-main: dispatching action", action);
    try {
      this._update(action, this.model);
    } catch (error) {
      console.log("frp-main: dispatch failed", error, action);
    }
  }

  // default update function; handles assignment messages
  static update(assignments, model) {
    console.log("frp-main: update", assignments);

    Object.entries(assignments).forEach(([key, value]) => {
      model[key] = value;
    });
    return model;
  }
}

customElements.define("frp-main", FrpMain);

// JS Definition from scene 1
class FrpExample1 extends FrpMain {
  constructor() {
    super({ count: 10 }, FrpExample1.update, FrpExample1.MsgType);
  }

  static MsgType = {
    Increment: () => ({ Increment: {} }),
    Decrement: () => ({ Decrement: {} }),
  };

  static update(message, model) {
    const { count } = model;

    switch (Object.keys(message)[0]) {
      case "Increment":
        return (model.count = count + 1);
      case "Decrement":
        return (model.count = Math.max(0, count - 1));
    }
  }
}

customElements.define("frp-example-1", FrpExample1);

// JS Definition from scene 2
class FrpView extends HTMLElement {
  constructor() {
    super();
    let content = document.getElementById("frp-view-template").content;
    this.attachShadow({ mode: "open" }).appendChild(content.cloneNode(true));
    this.dataset["frpView"] = "FrpView";

    console.log("frp-view constructed");
  }

  connectedCallback() {
    this._observing = this.getAttribute("observing");
    this._dispatching = this.getAttribute("dispatching");
    this.observable = FrpMain.whenObservableFrom(this);
  }

  // used by descendants to find their view
  static closest(element) {
    return element.closest("[data-frp-view]");
  }

  get observers() {
    return this._observing || "model";
  }

  get messages() {
    return this._dispatching || "Msg";
  }

  observe(fn, observer) {
    const update = (model) => {
      Promise.resolve(fn(model))
        .then((value) => observer.update(value))
        .catch((error) => observer.report(error));
    };

    this.observable.then(({ model, attach }) => {
      attach(update);
      update(model);
    });
  }
}

customElements.define("frp-view", FrpView);

// JS Definition from scene 3
class FrpExample2 extends FrpMain {
  constructor() {
    super(connectStore().root, FrpExample2.update);
  }
}

customElements.define("frp-example-2", FrpExample2);

// JS Definition from scene 4
class FrpText extends HTMLElement {
  constructor() {
    super();
    let content = document.getElementById("frp-text-template").content;
    this.attachShadow({ mode: "open" }).appendChild(content.cloneNode(true));
  }

  connectedCallback() {
    const expr = this.textContent.replaceAll(/[`\\]/g, "\\$&");
    const view = FrpView.closest(this);
    const renderFn = Function(
      "__model__",
      `const ${view.observers} = __model__;
       return \`${expr}\`;
      `
    ).bind(this);

    console.log("frp-text: ", view.observers, expr);

    view.observe(renderFn, this);
  }

  update(value) {
    const slot = this.shadowRoot.firstElementChild;
    const span = this.shadowRoot.getElementById("value");

    slot.className = "filled";
    span.innerText = value;
    span.className = `${typeof value}-value`;
  }

  report(error) {
    const span = this.shadowRoot.getElementById("value");

    slot.className = "error";
  }
}

customElements.define("frp-text", FrpText);

// JS Definition from scene 5
class FrpBind extends HTMLElement {
  constructor() {
    super();
    let content = document.getElementById("frp-bind-template").content;
    this.attachShadow({ mode: "open" }).appendChild(content.cloneNode(true));
  }

  connectedCallback() {
    this.main = FrpMain.closest(this);
    const view = FrpView.closest(this);
    const propNames = this.getAttributeNames().filter((name) => name !== "on");

    if (propNames) {
      const assignments = propNames
        .map((name) => {
          const expr = this.getAttribute(name);
          return `["${name}", ${expr}]`;
        })
        .join(",\n");
      const mapFn = Function(
        "__model__",
        `const ${view.observers} = __model__;
        return [ ${assignments} ];
        `
      );

      console.log("frp-bind: properties ", view.observers, assignments);

      view.observe(mapFn, this);
    }

    const onExpr = this.getAttribute("on");

    if (onExpr) {
      const dispatchFn = Function(
        "__dispatch__",
        "__Msg__",
        `const ${view.messages} = __Msg__;
         function actions (${view.observers}) {
           return (${onExpr});
         }
         const onevent = (__type__) =>
          function handler (__model__, __event__) {
            const fn = actions.call(this, __model__)[__type__];
            __dispatch__(fn(__event__))
          };
         const names = Object.keys(actions({}));
         return names.map((name) => ['on' + name, onevent(name)]);`
      );

      console.log("frp-bind: onevent handlers ", view.observers, dispatchFn);

      this.main
        .bind(dispatchFn)
        .then((handlers) => this.update(handlers))
        .catch((reason) => this.report(reason));
    }
  }

  update(entries) {
    const slot = this.shadowRoot.firstElementChild;
    const model = this.main.model;

    for (const target of this.children) {
      const bound = entries.map(([name, value]) =>
        // bind `this` and the model to on* functions
        [
          name,
          name.startsWith("on") && typeof value === "function"
            ? value.bind(target, model)
            : value,
        ]
      );
      bound.forEach(([name, value]) => {
        target[name] = value;
      });
      console.log("frp-bind: bound", bound, target);
    }
    slot.className = "bound";
  }

  report(reason) {
    const slot = this.shadowRoot.firstElementChild;

    slot.className = "error";
  }
}

customElements.define("frp-bind", FrpBind);

// JS Definition from scene 6
function createObservable(eventTarget, root) {
  const OBSERVABLE_CHANGE_EVENT = "observable:change";

  console.log("creating Observable:", JSON.stringify(root));

  let proxy = new Proxy(root, {
    get: (target, prop, receiver) => {
      if (prop === "then") {
        return undefined;
      }
      const value = Reflect.get(target, prop, receiver);
      console.log(`Observable['${prop}'] => ${JSON.stringify(value)}`);
      return value;
    },
    set: (target, prop, newValue, receiver) => {
      const oldValue = root[prop];
      console.log(
        `Observable['${prop}'] <= ${JSON.stringify(
          newValue
        )}; was ${JSON.stringify(oldValue)}`
      );
      const didSet = Reflect.set(target, prop, newValue, receiver);
      if (didSet) {
        let evt = new CustomEvent(OBSERVABLE_CHANGE_EVENT, {
          bubbles: true,
          cancelable: true,
        });
        Object.assign(evt, { property: prop, oldValue, value: newValue });
        eventTarget.dispatchEvent(evt);
        console.log("dispatched event to target", evt, eventTarget);
      } else {
        console.log(`Observable['${prop}] was not set to ${newValue}`);
      }
      return didSet;
    },
  });

  return proxy;
}

            return ({
              
            })
          }
          export function mount (mountpoint, initial) {
            let Store = {
              root: Object.assign({}, initial),
            };
            const connectStore = (path = ["root"]) => {
              let root = Store;
              path.forEach((key) => root = root[key]);
              return ({
                root,
                get: (key) => root[key],
                set: (key, value) => root[key] = value,
                keys: () => Object.keys(root),
              })};
            const program = Program({connectStore})
            return (n, container) => {
              program[n-1].call(container)
            }
          }
          register("Kram_d693e88c_reactive", {Program, mount})
        </script>
</head>
<body>
<template id="frp-main-template">
  <section id="frp-main">
    <slot></slot>
  </section>
</template>

<template id="frp-view-template">
  <slot></slot>
</template>

<template id="frp-text-template">
  <slot>Use template literal syntax here.</slot>
  <span id="value" class="undefined-value"></span><style>
    span.undefined-value,
    slot.filled {
      display: none;
    }

    span.error-value,
    slot.error {
      background: red;
      color: white;
    }
  </style></template>

<template id="frp-bind-template">
  <slot></slot>
</template>


<st-ative><script>
  const STORE_CHANGE_EVENT = "store:change";

  function createStore(eventTarget, initial = {}) {
    let root = Object.assign({}, initial);

    console.log("create Global Store for st-ative", JSON.stringify(root));

    return new Proxy(root, {
      get: (target, prop, receiver) => {
        const value = Reflect.get(target, prop, receiver);
        return value;
      },
      set: (target, prop, newValue, receiver) => {
        const oldValue = root[prop];
        const didSet = Reflect.set(target, prop, newValue, receiver);
        if (didSet) {
          eventTarget.dispatchEvent(changeEvent(prop, newValue, oldValue));
        }
        return didSet;
      },
    });
  }

  function changeEvent(prop, newValue, oldValue) {
    // ref: https://infrequently.org/2021/03/reactive-data-modern-js/
    let evt = new CustomEvent(STORE_CHANGE_EVENT, {
      bubbles: true,
      cancelable: true,
    });
    evt.oldValue = oldValue;
    evt.value = newValue;
    evt.property = prop;

    return evt;
  }

  customElements.define(
    "st-ative",
    class extends HTMLElement {
      constructor() {
        super();

        const storeRoot = [];
        let Store = createStore(this, {
          "current-scene": 1,
        });

        this.dataset.provider = JSON.stringify(storeRoot);

        this.observe = (key, watcher) => {
          if (watcher) {
            this.addEventListener(STORE_CHANGE_EVENT, (evt) => {
              if (evt.property === key) {
                watcher(evt.value, evt.oldValue);
              }
            });
          }
          return { value: Store[key] };
        };

        this.bind = (key, watcher) => {
          const observation = this.observe(key, watcher);
          return {
            get: () => Store[key],
            set: (newValue) => (Store[key] = newValue),
            ...observation,
          };
        };

        console.log("Store provider constructed");
      }
    }
  );
</script>

<!-- template -->
<article>
  
<navig-ative class="wguho-1wx"><!-- template --><footer>
  <h6><span>Reactive Programming with Components
</span></h6>
  <span>
    <button name="previous">Previous</button>
    <input width="6" type="number" min="1" value="1">
    <button name="next">Next</button>
  </span>
</footer>

<style>.wguho-1wx{height:var(--heightFooter)}.wguho-1wx footer{display:flex;flex-direction:row;padding:0.5rem;gap:0.5rem;justify-content:space-between;align-items:baseline}.wguho-1wx footer>*{margin:0}@media print{.wguho-1wx footer{display:none}}</style>
<!-- /template -->

<script>
  console.log("Defining navig-ative...");

  customElements.define(
    "navig-ative",
    class extends HTMLElement {
      connectedCallback() {
        let provider = this.closest("[data-provider]");
        let numberInput = this.querySelector(':scope input[type="number"]');
        let previousButton = this.querySelector(
          ':scope button[name="previous"]'
        );
        let nextButton = this.querySelector(':scope button[name="next"]');

        console.log("Navig-ative attempting to connect...", provider);

        if (provider) {
          const { get, set } = provider.bind(
            "current-scene",
            (newValue) => (numberInput.value = newValue)
          );

          numberInput.value = get();

          numberInput.addEventListener("change", () => set(numberInput.value));

          previousButton.addEventListener("click", () => set(get() - 1));

          nextButton.addEventListener("click", () => {
            set(get() + 1);
          });

          console.log("Consolid-ative (webc)");
        }
      }
    }
  );
</script>
</navig-ative>
<consolid-ative class="wca28tbqe"><!-- <template> for consolid-ative --><main class="layout">
  
<oper-ative class="wyn4ozqi9"><!-- template --><output class="render">
  <frp-example-1>
  <frp-view>
    <frp-bind on="{click: Msg.Decrement}">
      <button>Less cowbell</button>
    </frp-bind>
    <p><frp-text>The sound of ${model.count} cowbells.</frp-text></p>
    <frp-bind on="{click: Msg.Increment}">
      <button>More cowbell</button>
    </frp-bind>
  </frp-view>
</frp-example-1>

</output>

<style>.wyn4ozqi9{height:100%;width:100%;overflow:auto;grid-column:var(--render-grid-column)}.wyn4ozqi9 .render{min-width:100%;min-height:100%;display:block;position:relative;padding:var(--sizeRenderPadding)}@media print{.wyn4ozqi9{display:block;height:auto;overflow:hidden}.wyn4ozqi9 .render{min-width:0;min-height:0}}</style>
<!-- /template -->
</oper-ative>
<ide-ative data-language="auto" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"><code lang="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>frp-example-1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>frp-view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>frp-bind</span> <span class="token attr-name">on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{click: Msg.Decrement}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Less cowbell<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>frp-bind</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>frp-text</span><span class="token punctuation">&gt;</span></span>The sound of ${model.count} cowbells.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>frp-text</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>frp-bind</span> <span class="token attr-name">on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{click: Msg.Increment}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>More cowbell<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>frp-bind</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>frp-view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>frp-example-1</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
<narr-ative class="wgswgsgy9"><!-- template id="narr-ative" webc:raw --><section class="prose">
  <h1>FRP Example</h1>

<ide-ative data-language="js" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">FrpMain</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">init <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> update <span class="token operator">=</span> FrpMain<span class="token punctuation">.</span>update<span class="token punctuation">,</span> msgType <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"frp-main-template"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">"open"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_model <span class="token operator">=</span> <span class="token function">createObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_messageType <span class="token operator">=</span> msgType<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_update <span class="token operator">=</span> update<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token string">"frpMain"</span><span class="token punctuation">]</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"frp-main constructed "</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_model<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// used by descendants to find their main</span>
  <span class="token keyword">static</span> <span class="token function">closest</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> element<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">"[data-frp-main]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">whenObservableFrom</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> available <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">"[data-frp-main]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>available<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">model</span><span class="token operator">:</span> available<span class="token punctuation">.</span>model<span class="token punctuation">,</span>
        <span class="token literal-property property">attach</span><span class="token operator">:</span> available<span class="token punctuation">.</span><span class="token function">attachObserver</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>available<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// search for the closest undefined parent</span>
      <span class="token keyword">let</span> candidate <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">":not(:defined)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>candidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// wait for the blocking element to be defined,</span>
        <span class="token comment">// and then upgrade it when it is.</span>
        customElements<span class="token punctuation">.</span><span class="token function">whenDefined</span><span class="token punctuation">(</span>candidate<span class="token punctuation">.</span>localName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>candidate <span class="token keyword">instanceof</span> <span class="token class-name">FrpMain</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">model</span><span class="token operator">:</span> candidate<span class="token punctuation">.</span>model<span class="token punctuation">,</span>
              <span class="token literal-property property">attach</span><span class="token operator">:</span> candidate<span class="token punctuation">.</span><span class="token function">attachObserver</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>candidate<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// should continue up the tree, but for now, reject.</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Found </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>candidate<span class="token punctuation">.</span>localName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, but it is not FrpMain</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
              candidate<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token string">"No candidates found for frp-main element"</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">attachObserver</span><span class="token punctuation">(</span><span class="token parameter">update</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Setting up event listener for observer.update"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"observable:change"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// main provides the model (readonly)</span>
  <span class="token keyword">get</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_model<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">messageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_messageType<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">bind</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messageType<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">resolve</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"frp-main: dispatching action"</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"frp-main: dispatch failed"</span><span class="token punctuation">,</span> error<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// default update function; handles assignment messages</span>
  <span class="token keyword">static</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">assignments<span class="token punctuation">,</span> model</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"frp-main: update"</span><span class="token punctuation">,</span> assignments<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>assignments<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      model<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> model<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"frp-main"</span><span class="token punctuation">,</span> FrpMain<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
<ide-ative data-language="js" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">FrpExample1</span> <span class="token keyword">extends</span> <span class="token class-name">FrpMain</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> FrpExample1<span class="token punctuation">.</span>update<span class="token punctuation">,</span> FrpExample1<span class="token punctuation">.</span>MsgType<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> MsgType <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">Increment</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">Increment</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">Decrement</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">Decrement</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> model</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=</span> model<span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">"Increment"</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>model<span class="token punctuation">.</span>count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">"Decrement"</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>model<span class="token punctuation">.</span>count <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"frp-example-1"</span><span class="token punctuation">,</span> FrpExample1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
<ide-ative data-language="html" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>frp-main-template<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>frp-main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
</section>

<style>@import "/_styles/theme.css";.wgswgsgy9{grid-column:var(--prose-grid-column);grid-row-end:span 2;overflow:hidden auto;height:100%;width:100%}.wgswgsgy9 .prose{font-family:var(--fontBody);font-size:var(--textSizeProse);font-weight:var(--textWeightProse);line-height:var(--lineHeightProse);color:var(--textColorProse);outline:none;padding:10em 0 1em 0;height:min-content}.wgswgsgy9 .prose>*{margin:1rem;position:relative}.wgswgsgy9 .prose>ul,.wgswgsgy9 .prose>ol{margin-left:2rem}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6){max-width:65ch}.wgswgsgy9 .prose>figure{margin:0.5rem}.wgswgsgy9 .prose pre>*:focus{outline:none}.wgswgsgy9 .prose>h1,.wgswgsgy9 .prose>h2,.wgswgsgy9 .prose>h3,.wgswgsgy9 .prose>h4,.wgswgsgy9 .prose>h5,.wgswgsgy9 .prose>h6{font-family:var(--fontDisplay);font-weight:var(--textWeightHeading);color:var(--textColorHeading)}.wgswgsgy9 .prose>h1{font-size:var(--textSizeH1)}.wgswgsgy9 .prose>h2{font-size:var(--textSizeH2)}.wgswgsgy9 .prose>h3{font-size:var(--textSizeH3)}.wgswgsgy9 .prose pre[class*="language-"]{overflow:hidden}.wgswgsgy9 .prose>*+*{margin-top:0.5em}.wgswgsgy9 .prose>h1+*{margin-top:2em}.wgswgsgy9 .prose ul,.wgswgsgy9 .prose ol{padding-left:1em}.wgswgsgy9 .prose ul>li,.wgswgsgy9 .prose ol>li{position:relative}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>code{color:var(--textColorInlineCode);font-family:var(--fontCode);background:var(--backgroundInlineCode)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) a{color:inherit;text-decoration:none;background:linear-gradient(transparent,transparent 50%,var(--backgroundLink));padding:0 0.25em;border:var(--borderLink);border-radius:var(--borderRadiusLink);cursor:pointer}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) a:hover{color:var(--textColorHoverLink)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) strong{font-weight:var(--textWeightStrong)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) em{font-style:--var(textStyleEmphasis)}.wgswgsgy9 .prose>br{margin:0;line-height:0}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>*::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>*::after{display:inline;color:var(--textColorMarkup);background:var(--backgroundMarkup);font-family:var(--fontCode);line-height:var(--lineHeightMarkup);font-style:var(--textStyleMarkup);border-radius:var(--borderRadiusMarkup);font-size:var(--textSizeMarkup);font-weight:var(--textWeightMarkup);padding:var(--borderRadiusMarkup);vertical-align:0.2em;border:var(--borderMarkup);margin:0 0.1rem}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)::before,.wgswgsgy9 .prose>*>li::before{display:block;position:absolute;right:100%;top:0.2em;height:1rem;width:1rem}.wgswgsgy9 .prose>ul::before,.wgswgsgy9 .prose>ol::before{display:block;position:absolute;right:100%}.wgswgsgy9 .prose>[data-mark-before]:focus::before{content:attr(data-mark-before)}.wgswgsgy9 .prose>*:focus>li[data-mark-before]{list-style:none}.wgswgsgy9 .prose>*:focus>li[data-mark-before]::before{content:attr(data-mark-before)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus [data-mark-around]::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus [data-mark-around]::after{content:attr(data-mark-around)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a::before{content:"["}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a::after{content:"]"}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a[href]::after{content:"]("attr(href)")"}@media print{.wgswgsgy9{break-before:page}.wgswgsgy9 .prose{width:100%;display:flex;flex-direction:column;align-items:center}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6){max-width:40rem;width:60%}}</style>
<!-- /template -->


</narr-ative>
<oper-ative class="wyn4ozqi9"><!-- template --><output class="render">
  
</output>

<style>.wyn4ozqi9{height:100%;width:100%;overflow:auto;grid-column:var(--render-grid-column)}.wyn4ozqi9 .render{min-width:100%;min-height:100%;display:block;position:relative;padding:var(--sizeRenderPadding)}@media print{.wyn4ozqi9{display:block;height:auto;overflow:hidden}.wyn4ozqi9 .render{min-width:0;min-height:0}}</style>
<!-- /template -->
</oper-ative>
<ide-ative data-language="auto" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
<narr-ative class="wgswgsgy9"><!-- template id="narr-ative" webc:raw --><section class="prose">
  <h2>View watches for changes to values it needs</h2>

<ide-ative data-language="js" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">FrpView</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"frp-view-template"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">"open"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token string">"frpView"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"FrpView"</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"frp-view constructed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_observing <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"observing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_dispatching <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"dispatching"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>observable <span class="token operator">=</span> FrpMain<span class="token punctuation">.</span><span class="token function">whenObservableFrom</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// used by descendants to find their view</span>
  <span class="token keyword">static</span> <span class="token function">closest</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> element<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">"[data-frp-view]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">observers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_observing <span class="token operator">||</span> <span class="token string">"model"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">messages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_dispatching <span class="token operator">||</span> <span class="token string">"Msg"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">model</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> observer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> observer<span class="token punctuation">.</span><span class="token function">report</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>observable<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> model<span class="token punctuation">,</span> attach <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">attach</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">update</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"frp-view"</span><span class="token punctuation">,</span> FrpView<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
<ide-ative data-language="html" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>frp-view-template<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
</section>

<style>@import "/_styles/theme.css";.wgswgsgy9{grid-column:var(--prose-grid-column);grid-row-end:span 2;overflow:hidden auto;height:100%;width:100%}.wgswgsgy9 .prose{font-family:var(--fontBody);font-size:var(--textSizeProse);font-weight:var(--textWeightProse);line-height:var(--lineHeightProse);color:var(--textColorProse);outline:none;padding:10em 0 1em 0;height:min-content}.wgswgsgy9 .prose>*{margin:1rem;position:relative}.wgswgsgy9 .prose>ul,.wgswgsgy9 .prose>ol{margin-left:2rem}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6){max-width:65ch}.wgswgsgy9 .prose>figure{margin:0.5rem}.wgswgsgy9 .prose pre>*:focus{outline:none}.wgswgsgy9 .prose>h1,.wgswgsgy9 .prose>h2,.wgswgsgy9 .prose>h3,.wgswgsgy9 .prose>h4,.wgswgsgy9 .prose>h5,.wgswgsgy9 .prose>h6{font-family:var(--fontDisplay);font-weight:var(--textWeightHeading);color:var(--textColorHeading)}.wgswgsgy9 .prose>h1{font-size:var(--textSizeH1)}.wgswgsgy9 .prose>h2{font-size:var(--textSizeH2)}.wgswgsgy9 .prose>h3{font-size:var(--textSizeH3)}.wgswgsgy9 .prose pre[class*="language-"]{overflow:hidden}.wgswgsgy9 .prose>*+*{margin-top:0.5em}.wgswgsgy9 .prose>h1+*{margin-top:2em}.wgswgsgy9 .prose ul,.wgswgsgy9 .prose ol{padding-left:1em}.wgswgsgy9 .prose ul>li,.wgswgsgy9 .prose ol>li{position:relative}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>code{color:var(--textColorInlineCode);font-family:var(--fontCode);background:var(--backgroundInlineCode)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) a{color:inherit;text-decoration:none;background:linear-gradient(transparent,transparent 50%,var(--backgroundLink));padding:0 0.25em;border:var(--borderLink);border-radius:var(--borderRadiusLink);cursor:pointer}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) a:hover{color:var(--textColorHoverLink)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) strong{font-weight:var(--textWeightStrong)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) em{font-style:--var(textStyleEmphasis)}.wgswgsgy9 .prose>br{margin:0;line-height:0}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>*::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>*::after{display:inline;color:var(--textColorMarkup);background:var(--backgroundMarkup);font-family:var(--fontCode);line-height:var(--lineHeightMarkup);font-style:var(--textStyleMarkup);border-radius:var(--borderRadiusMarkup);font-size:var(--textSizeMarkup);font-weight:var(--textWeightMarkup);padding:var(--borderRadiusMarkup);vertical-align:0.2em;border:var(--borderMarkup);margin:0 0.1rem}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)::before,.wgswgsgy9 .prose>*>li::before{display:block;position:absolute;right:100%;top:0.2em;height:1rem;width:1rem}.wgswgsgy9 .prose>ul::before,.wgswgsgy9 .prose>ol::before{display:block;position:absolute;right:100%}.wgswgsgy9 .prose>[data-mark-before]:focus::before{content:attr(data-mark-before)}.wgswgsgy9 .prose>*:focus>li[data-mark-before]{list-style:none}.wgswgsgy9 .prose>*:focus>li[data-mark-before]::before{content:attr(data-mark-before)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus [data-mark-around]::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus [data-mark-around]::after{content:attr(data-mark-around)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a::before{content:"["}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a::after{content:"]"}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a[href]::after{content:"]("attr(href)")"}@media print{.wgswgsgy9{break-before:page}.wgswgsgy9 .prose{width:100%;display:flex;flex-direction:column;align-items:center}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6){max-width:40rem;width:60%}}</style>
<!-- /template -->


</narr-ative>
<oper-ative class="wyn4ozqi9"><!-- template --><output class="render">
  <frp-example-2>
  <frp-view observing="{copyright_year, author, page_views}">
    <p>
      <frp-text> Copyright ${copyright_year} by ${author}.</frp-text>
    </p>
    <p>
      <frp-text>This page has been viewed ${page_views} times.</frp-text>
    </p>
  </frp-view>
  <frp-view>
    <p>
      <frp-bind on="{click: () => ({page_views: model.page_views+1})}">
        <button>Increment View Counter</button>
      </frp-bind>
    </p>
    <p>
      <frp-bind value="(model.author)" on="{change: () => ({author: this.value})}">
        <input>
      </frp-bind>
    </p>
  </frp-view>
</frp-example-2>

</output>

<style>.wyn4ozqi9{height:100%;width:100%;overflow:auto;grid-column:var(--render-grid-column)}.wyn4ozqi9 .render{min-width:100%;min-height:100%;display:block;position:relative;padding:var(--sizeRenderPadding)}@media print{.wyn4ozqi9{display:block;height:auto;overflow:hidden}.wyn4ozqi9 .render{min-width:0;min-height:0}}</style>
<!-- /template -->
</oper-ative>
<ide-ative data-language="auto" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"><code lang="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>frp-example-2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>frp-view</span> <span class="token attr-name">observing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{copyright_year, author, page_views}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>frp-text</span><span class="token punctuation">&gt;</span></span><span title="" class="token entity named-entity">&amp;copy;</span> Copyright ${copyright_year} by ${author}.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>frp-text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>frp-text</span><span class="token punctuation">&gt;</span></span>This page has been viewed ${page_views} times.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>frp-text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>frp-view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>frp-view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>frp-bind</span> <span class="token attr-name">on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{click: () =&gt; ({page_views: model.page_views+1})}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Increment View Counter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>frp-bind</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>frp-bind</span>
        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(model.author)<span class="token punctuation">"</span></span>
        <span class="token attr-name">on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{change: () =&gt; ({author: this.value})}<span class="token punctuation">"</span></span>
      <span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>frp-bind</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>frp-view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>frp-example-2</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
<narr-ative class="wgswgsgy9"><!-- template id="narr-ative" webc:raw --><section class="prose">
  <h2>Exposing parts of a model to a view</h2>

<p>The basis of reactive programming is that all side-effects are sent to
data store which is provided by the root element of the UI.
To the rest of the code, the store is read-only.</p>

<blockquote><p>Programming with, or designing upon, asynchronous data streams</p></blockquote>

<blockquote><p>The essence of functional reactive programming is to specify the
dynamic behavior of a value completely at the time of declaration.</p></blockquote>

<p>Components may get values from the store, and also listen for change events.</p>

<p>All dynamic web pages require code that retrieves data (for example, from an API)
and inserts it into the HTML or DOM.
Originally, this was accomplished with templating on the server.
But if the data changes, we dont want to reload the entire page, just the data that changed.
Typically, this means using Javascript to fetch the data and then manipulate the DOM.</p>

<p>This is not easy to do. The problem of keeping the DOM in sync with data stored in Javascript
has given rise to multiple competing frameworks; client-side rendering; a proposed extension to JS to add HTML expressions;
and ultimately the idea that Javascript, not HTML, is the lingua franca of the web.</p>

<p>The difficulty here is that HTML provides very few hooks to attach Javascript to elements.
Unless the element was created by JS in the browser,
the only way to get a JS handle for an element
is by querying the DOM.
This introduces dependencies between the HTML and Javascript,
making it difficult to change either.
HTML custom elements address this difficulty,
because they allow us attach Javascript functionality to elements.</p>

<p>Typically, we have a record of data, and a chunk of HTML that presents the data.
What we want is a way, <em data-mark-around="_">from HTML</em>, to say put this piece of data here.</p>

<p>So lets define two components: one that lets us identify a set of data we want to present,
and one to indicate where to insert each piece.</p>

<ide-ative data-language="js" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">FrpExample2</span> <span class="token keyword">extends</span> <span class="token class-name">FrpMain</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token function">connectStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>root<span class="token punctuation">,</span> FrpExample2<span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"frp-example-2"</span><span class="token punctuation">,</span> FrpExample2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
</section>

<style>@import "/_styles/theme.css";.wgswgsgy9{grid-column:var(--prose-grid-column);grid-row-end:span 2;overflow:hidden auto;height:100%;width:100%}.wgswgsgy9 .prose{font-family:var(--fontBody);font-size:var(--textSizeProse);font-weight:var(--textWeightProse);line-height:var(--lineHeightProse);color:var(--textColorProse);outline:none;padding:10em 0 1em 0;height:min-content}.wgswgsgy9 .prose>*{margin:1rem;position:relative}.wgswgsgy9 .prose>ul,.wgswgsgy9 .prose>ol{margin-left:2rem}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6){max-width:65ch}.wgswgsgy9 .prose>figure{margin:0.5rem}.wgswgsgy9 .prose pre>*:focus{outline:none}.wgswgsgy9 .prose>h1,.wgswgsgy9 .prose>h2,.wgswgsgy9 .prose>h3,.wgswgsgy9 .prose>h4,.wgswgsgy9 .prose>h5,.wgswgsgy9 .prose>h6{font-family:var(--fontDisplay);font-weight:var(--textWeightHeading);color:var(--textColorHeading)}.wgswgsgy9 .prose>h1{font-size:var(--textSizeH1)}.wgswgsgy9 .prose>h2{font-size:var(--textSizeH2)}.wgswgsgy9 .prose>h3{font-size:var(--textSizeH3)}.wgswgsgy9 .prose pre[class*="language-"]{overflow:hidden}.wgswgsgy9 .prose>*+*{margin-top:0.5em}.wgswgsgy9 .prose>h1+*{margin-top:2em}.wgswgsgy9 .prose ul,.wgswgsgy9 .prose ol{padding-left:1em}.wgswgsgy9 .prose ul>li,.wgswgsgy9 .prose ol>li{position:relative}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>code{color:var(--textColorInlineCode);font-family:var(--fontCode);background:var(--backgroundInlineCode)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) a{color:inherit;text-decoration:none;background:linear-gradient(transparent,transparent 50%,var(--backgroundLink));padding:0 0.25em;border:var(--borderLink);border-radius:var(--borderRadiusLink);cursor:pointer}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) a:hover{color:var(--textColorHoverLink)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) strong{font-weight:var(--textWeightStrong)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) em{font-style:--var(textStyleEmphasis)}.wgswgsgy9 .prose>br{margin:0;line-height:0}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>*::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>*::after{display:inline;color:var(--textColorMarkup);background:var(--backgroundMarkup);font-family:var(--fontCode);line-height:var(--lineHeightMarkup);font-style:var(--textStyleMarkup);border-radius:var(--borderRadiusMarkup);font-size:var(--textSizeMarkup);font-weight:var(--textWeightMarkup);padding:var(--borderRadiusMarkup);vertical-align:0.2em;border:var(--borderMarkup);margin:0 0.1rem}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)::before,.wgswgsgy9 .prose>*>li::before{display:block;position:absolute;right:100%;top:0.2em;height:1rem;width:1rem}.wgswgsgy9 .prose>ul::before,.wgswgsgy9 .prose>ol::before{display:block;position:absolute;right:100%}.wgswgsgy9 .prose>[data-mark-before]:focus::before{content:attr(data-mark-before)}.wgswgsgy9 .prose>*:focus>li[data-mark-before]{list-style:none}.wgswgsgy9 .prose>*:focus>li[data-mark-before]::before{content:attr(data-mark-before)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus [data-mark-around]::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus [data-mark-around]::after{content:attr(data-mark-around)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a::before{content:"["}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a::after{content:"]"}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a[href]::after{content:"]("attr(href)")"}@media print{.wgswgsgy9{break-before:page}.wgswgsgy9 .prose{width:100%;display:flex;flex-direction:column;align-items:center}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6){max-width:40rem;width:60%}}</style>
<!-- /template -->


</narr-ative>
<oper-ative class="wyn4ozqi9"><!-- template --><output class="render">
  
</output>

<style>.wyn4ozqi9{height:100%;width:100%;overflow:auto;grid-column:var(--render-grid-column)}.wyn4ozqi9 .render{min-width:100%;min-height:100%;display:block;position:relative;padding:var(--sizeRenderPadding)}@media print{.wyn4ozqi9{display:block;height:auto;overflow:hidden}.wyn4ozqi9 .render{min-width:0;min-height:0}}</style>
<!-- /template -->
</oper-ative>
<ide-ative data-language="auto" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
<narr-ative class="wgswgsgy9"><!-- template id="narr-ative" webc:raw --><section class="prose">
  <ide-ative data-language="js" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">FrpText</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"frp-text-template"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">"open"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> expr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[`\\]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"\\$&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> view <span class="token operator">=</span> FrpView<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> renderFn <span class="token operator">=</span> <span class="token function">Function</span><span class="token punctuation">(</span>
      <span class="token string">"__model__"</span><span class="token punctuation">,</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">const </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>view<span class="token punctuation">.</span>observers<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = __model__;
       return \`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\`;
      </span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"frp-text: "</span><span class="token punctuation">,</span> view<span class="token punctuation">.</span>observers<span class="token punctuation">,</span> expr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    view<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>renderFn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> slot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span>
    <span class="token keyword">const</span> span <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    slot<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">"filled"</span><span class="token punctuation">;</span>
    span<span class="token punctuation">.</span>innerText <span class="token operator">=</span> value<span class="token punctuation">;</span>
    span<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">typeof</span> value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-value</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">report</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> span <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    slot<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">"error"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"frp-text"</span><span class="token punctuation">,</span> FrpText<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
<ide-ative data-language="html" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>frp-text-template<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span>Use template literal syntax here.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>undefined-value<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span>
  <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">span.undefined-value,
    slot.filled</span> <span class="token punctuation">{</span>
      <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token selector">span.error-value,
    slot.error</span> <span class="token punctuation">{</span>
      <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span>
<span class="token punctuation">&gt;</span></span>
</code></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
</section>

<style>@import "/_styles/theme.css";.wgswgsgy9{grid-column:var(--prose-grid-column);grid-row-end:span 2;overflow:hidden auto;height:100%;width:100%}.wgswgsgy9 .prose{font-family:var(--fontBody);font-size:var(--textSizeProse);font-weight:var(--textWeightProse);line-height:var(--lineHeightProse);color:var(--textColorProse);outline:none;padding:10em 0 1em 0;height:min-content}.wgswgsgy9 .prose>*{margin:1rem;position:relative}.wgswgsgy9 .prose>ul,.wgswgsgy9 .prose>ol{margin-left:2rem}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6){max-width:65ch}.wgswgsgy9 .prose>figure{margin:0.5rem}.wgswgsgy9 .prose pre>*:focus{outline:none}.wgswgsgy9 .prose>h1,.wgswgsgy9 .prose>h2,.wgswgsgy9 .prose>h3,.wgswgsgy9 .prose>h4,.wgswgsgy9 .prose>h5,.wgswgsgy9 .prose>h6{font-family:var(--fontDisplay);font-weight:var(--textWeightHeading);color:var(--textColorHeading)}.wgswgsgy9 .prose>h1{font-size:var(--textSizeH1)}.wgswgsgy9 .prose>h2{font-size:var(--textSizeH2)}.wgswgsgy9 .prose>h3{font-size:var(--textSizeH3)}.wgswgsgy9 .prose pre[class*="language-"]{overflow:hidden}.wgswgsgy9 .prose>*+*{margin-top:0.5em}.wgswgsgy9 .prose>h1+*{margin-top:2em}.wgswgsgy9 .prose ul,.wgswgsgy9 .prose ol{padding-left:1em}.wgswgsgy9 .prose ul>li,.wgswgsgy9 .prose ol>li{position:relative}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>code{color:var(--textColorInlineCode);font-family:var(--fontCode);background:var(--backgroundInlineCode)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) a{color:inherit;text-decoration:none;background:linear-gradient(transparent,transparent 50%,var(--backgroundLink));padding:0 0.25em;border:var(--borderLink);border-radius:var(--borderRadiusLink);cursor:pointer}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) a:hover{color:var(--textColorHoverLink)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) strong{font-weight:var(--textWeightStrong)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) em{font-style:--var(textStyleEmphasis)}.wgswgsgy9 .prose>br{margin:0;line-height:0}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>*::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>*::after{display:inline;color:var(--textColorMarkup);background:var(--backgroundMarkup);font-family:var(--fontCode);line-height:var(--lineHeightMarkup);font-style:var(--textStyleMarkup);border-radius:var(--borderRadiusMarkup);font-size:var(--textSizeMarkup);font-weight:var(--textWeightMarkup);padding:var(--borderRadiusMarkup);vertical-align:0.2em;border:var(--borderMarkup);margin:0 0.1rem}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)::before,.wgswgsgy9 .prose>*>li::before{display:block;position:absolute;right:100%;top:0.2em;height:1rem;width:1rem}.wgswgsgy9 .prose>ul::before,.wgswgsgy9 .prose>ol::before{display:block;position:absolute;right:100%}.wgswgsgy9 .prose>[data-mark-before]:focus::before{content:attr(data-mark-before)}.wgswgsgy9 .prose>*:focus>li[data-mark-before]{list-style:none}.wgswgsgy9 .prose>*:focus>li[data-mark-before]::before{content:attr(data-mark-before)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus [data-mark-around]::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus [data-mark-around]::after{content:attr(data-mark-around)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a::before{content:"["}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a::after{content:"]"}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a[href]::after{content:"]("attr(href)")"}@media print{.wgswgsgy9{break-before:page}.wgswgsgy9 .prose{width:100%;display:flex;flex-direction:column;align-items:center}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6){max-width:40rem;width:60%}}</style>
<!-- /template -->


</narr-ative>
<oper-ative class="wyn4ozqi9"><!-- template --><output class="render">
  
</output>

<style>.wyn4ozqi9{height:100%;width:100%;overflow:auto;grid-column:var(--render-grid-column)}.wyn4ozqi9 .render{min-width:100%;min-height:100%;display:block;position:relative;padding:var(--sizeRenderPadding)}@media print{.wyn4ozqi9{display:block;height:auto;overflow:hidden}.wyn4ozqi9 .render{min-width:0;min-height:0}}</style>
<!-- /template -->
</oper-ative>
<ide-ative data-language="auto" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
<narr-ative class="wgswgsgy9"><!-- template id="narr-ative" webc:raw --><section class="prose">
  <h2>Binding element properties and event handlers</h2>

<ide-ative data-language="js" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">FrpBind</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"frp-bind-template"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">"open"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>main <span class="token operator">=</span> FrpMain<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> view <span class="token operator">=</span> FrpView<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> propNames <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttributeNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> name <span class="token operator">!==</span> <span class="token string">"on"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>propNames<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> assignments <span class="token operator">=</span> propNames
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> expr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">["</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">", </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">",\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> mapFn <span class="token operator">=</span> <span class="token function">Function</span><span class="token punctuation">(</span>
        <span class="token string">"__model__"</span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">const </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>view<span class="token punctuation">.</span>observers<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = __model__;
        return [ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>assignments<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ];
        </span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"frp-bind: properties "</span><span class="token punctuation">,</span> view<span class="token punctuation">.</span>observers<span class="token punctuation">,</span> assignments<span class="token punctuation">)</span><span class="token punctuation">;</span>

      view<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>mapFn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> onExpr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"on"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>onExpr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> dispatchFn <span class="token operator">=</span> <span class="token function">Function</span><span class="token punctuation">(</span>
        <span class="token string">"__dispatch__"</span><span class="token punctuation">,</span>
        <span class="token string">"__Msg__"</span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">const </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>view<span class="token punctuation">.</span>messages<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = __Msg__;
         function actions (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>view<span class="token punctuation">.</span>observers<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) {
           return (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>onExpr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">);
         }
         const onevent = (__type__) =&gt;
          function handler (__model__, __event__) {
            const fn = actions.call(this, __model__)[__type__];
            __dispatch__(fn(__event__))
          };
         const names = Object.keys(actions({}));
         return names.map((name) =&gt; ['on' + name, onevent(name)]);</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"frp-bind: onevent handlers "</span><span class="token punctuation">,</span> view<span class="token punctuation">.</span>observers<span class="token punctuation">,</span> dispatchFn<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">main</span>
        <span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>dispatchFn<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">handlers</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>handlers<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">report</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> slot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span>
    <span class="token keyword">const</span> model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span>model<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> target <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> bound <span class="token operator">=</span> entries<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>name<span class="token punctuation">,</span> value<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token comment">// bind `this` and the model to on* functions</span>
        <span class="token punctuation">[</span>
          name<span class="token punctuation">,</span>
          name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"on"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">"function"</span>
            <span class="token operator">?</span> <span class="token function">value</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> model<span class="token punctuation">)</span>
            <span class="token operator">:</span> value<span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      bound<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>name<span class="token punctuation">,</span> value<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"frp-bind: bound"</span><span class="token punctuation">,</span> bound<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    slot<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">"bound"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">report</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> slot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span>

    slot<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">"error"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"frp-bind"</span><span class="token punctuation">,</span> FrpBind<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
<ide-ative data-language="html" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>frp-bind-template<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
</section>

<style>@import "/_styles/theme.css";.wgswgsgy9{grid-column:var(--prose-grid-column);grid-row-end:span 2;overflow:hidden auto;height:100%;width:100%}.wgswgsgy9 .prose{font-family:var(--fontBody);font-size:var(--textSizeProse);font-weight:var(--textWeightProse);line-height:var(--lineHeightProse);color:var(--textColorProse);outline:none;padding:10em 0 1em 0;height:min-content}.wgswgsgy9 .prose>*{margin:1rem;position:relative}.wgswgsgy9 .prose>ul,.wgswgsgy9 .prose>ol{margin-left:2rem}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6){max-width:65ch}.wgswgsgy9 .prose>figure{margin:0.5rem}.wgswgsgy9 .prose pre>*:focus{outline:none}.wgswgsgy9 .prose>h1,.wgswgsgy9 .prose>h2,.wgswgsgy9 .prose>h3,.wgswgsgy9 .prose>h4,.wgswgsgy9 .prose>h5,.wgswgsgy9 .prose>h6{font-family:var(--fontDisplay);font-weight:var(--textWeightHeading);color:var(--textColorHeading)}.wgswgsgy9 .prose>h1{font-size:var(--textSizeH1)}.wgswgsgy9 .prose>h2{font-size:var(--textSizeH2)}.wgswgsgy9 .prose>h3{font-size:var(--textSizeH3)}.wgswgsgy9 .prose pre[class*="language-"]{overflow:hidden}.wgswgsgy9 .prose>*+*{margin-top:0.5em}.wgswgsgy9 .prose>h1+*{margin-top:2em}.wgswgsgy9 .prose ul,.wgswgsgy9 .prose ol{padding-left:1em}.wgswgsgy9 .prose ul>li,.wgswgsgy9 .prose ol>li{position:relative}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>code{color:var(--textColorInlineCode);font-family:var(--fontCode);background:var(--backgroundInlineCode)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) a{color:inherit;text-decoration:none;background:linear-gradient(transparent,transparent 50%,var(--backgroundLink));padding:0 0.25em;border:var(--borderLink);border-radius:var(--borderRadiusLink);cursor:pointer}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) a:hover{color:var(--textColorHoverLink)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) strong{font-weight:var(--textWeightStrong)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) em{font-style:--var(textStyleEmphasis)}.wgswgsgy9 .prose>br{margin:0;line-height:0}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>*::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>*::after{display:inline;color:var(--textColorMarkup);background:var(--backgroundMarkup);font-family:var(--fontCode);line-height:var(--lineHeightMarkup);font-style:var(--textStyleMarkup);border-radius:var(--borderRadiusMarkup);font-size:var(--textSizeMarkup);font-weight:var(--textWeightMarkup);padding:var(--borderRadiusMarkup);vertical-align:0.2em;border:var(--borderMarkup);margin:0 0.1rem}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)::before,.wgswgsgy9 .prose>*>li::before{display:block;position:absolute;right:100%;top:0.2em;height:1rem;width:1rem}.wgswgsgy9 .prose>ul::before,.wgswgsgy9 .prose>ol::before{display:block;position:absolute;right:100%}.wgswgsgy9 .prose>[data-mark-before]:focus::before{content:attr(data-mark-before)}.wgswgsgy9 .prose>*:focus>li[data-mark-before]{list-style:none}.wgswgsgy9 .prose>*:focus>li[data-mark-before]::before{content:attr(data-mark-before)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus [data-mark-around]::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus [data-mark-around]::after{content:attr(data-mark-around)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a::before{content:"["}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a::after{content:"]"}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a[href]::after{content:"]("attr(href)")"}@media print{.wgswgsgy9{break-before:page}.wgswgsgy9 .prose{width:100%;display:flex;flex-direction:column;align-items:center}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6){max-width:40rem;width:60%}}</style>
<!-- /template -->


</narr-ative>
<oper-ative class="wyn4ozqi9"><!-- template --><output class="render">
  
</output>

<style>.wyn4ozqi9{height:100%;width:100%;overflow:auto;grid-column:var(--render-grid-column)}.wyn4ozqi9 .render{min-width:100%;min-height:100%;display:block;position:relative;padding:var(--sizeRenderPadding)}@media print{.wyn4ozqi9{display:block;height:auto;overflow:hidden}.wyn4ozqi9 .render{min-width:0;min-height:0}}</style>
<!-- /template -->
</oper-ative>
<ide-ative data-language="auto" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
<narr-ative class="wgswgsgy9"><!-- template id="narr-ative" webc:raw --><section class="prose">
  <h2>Under the Hood: Proxies implement Observable</h2>

<ide-ative data-language="js" class="wbxffgulu"><!-- template --><figure class="code">
  <figcaption></figcaption>
  <pre class="language-markup"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createObservable</span><span class="token punctuation">(</span><span class="token parameter">eventTarget<span class="token punctuation">,</span> root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token constant">OBSERVABLE_CHANGE_EVENT</span> <span class="token operator">=</span> <span class="token string">"observable:change"</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"creating Observable:"</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token operator">===</span> <span class="token string">"then"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Observable['</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prop<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'] =&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> newValue<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> oldValue <span class="token operator">=</span> root<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Observable['</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prop<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'] &lt;= </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>
          newValue
        <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">; was </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> didSet <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> newValue<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>didSet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> evt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token constant">OBSERVABLE_CHANGE_EVENT</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">bubbles</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">cancelable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>evt<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">property</span><span class="token operator">:</span> prop<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> newValue <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        eventTarget<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"dispatched event to target"</span><span class="token punctuation">,</span> evt<span class="token punctuation">,</span> eventTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Observable['</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prop<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] was not set to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> didSet<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> proxy<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</figure>

<style>.wbxffgulu{--ide-language: attr(data-language);height:100%;width:100%;overflow:hidden;grid-column:var(--code-grid-column)}.wbxffgulu .code{height:max-content;max-width:100%;max-height:100%;overflow:auto}.wbxffgulu figcaption:empty::after{content:var(--ide-language, "code")}@media print{.wbxffgulu{display:block;height:auto;break-inside:avoid}}</style>
<!-- /template -->
</ide-ative>
</section>

<style>@import "/_styles/theme.css";.wgswgsgy9{grid-column:var(--prose-grid-column);grid-row-end:span 2;overflow:hidden auto;height:100%;width:100%}.wgswgsgy9 .prose{font-family:var(--fontBody);font-size:var(--textSizeProse);font-weight:var(--textWeightProse);line-height:var(--lineHeightProse);color:var(--textColorProse);outline:none;padding:10em 0 1em 0;height:min-content}.wgswgsgy9 .prose>*{margin:1rem;position:relative}.wgswgsgy9 .prose>ul,.wgswgsgy9 .prose>ol{margin-left:2rem}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6){max-width:65ch}.wgswgsgy9 .prose>figure{margin:0.5rem}.wgswgsgy9 .prose pre>*:focus{outline:none}.wgswgsgy9 .prose>h1,.wgswgsgy9 .prose>h2,.wgswgsgy9 .prose>h3,.wgswgsgy9 .prose>h4,.wgswgsgy9 .prose>h5,.wgswgsgy9 .prose>h6{font-family:var(--fontDisplay);font-weight:var(--textWeightHeading);color:var(--textColorHeading)}.wgswgsgy9 .prose>h1{font-size:var(--textSizeH1)}.wgswgsgy9 .prose>h2{font-size:var(--textSizeH2)}.wgswgsgy9 .prose>h3{font-size:var(--textSizeH3)}.wgswgsgy9 .prose pre[class*="language-"]{overflow:hidden}.wgswgsgy9 .prose>*+*{margin-top:0.5em}.wgswgsgy9 .prose>h1+*{margin-top:2em}.wgswgsgy9 .prose ul,.wgswgsgy9 .prose ol{padding-left:1em}.wgswgsgy9 .prose ul>li,.wgswgsgy9 .prose ol>li{position:relative}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>code{color:var(--textColorInlineCode);font-family:var(--fontCode);background:var(--backgroundInlineCode)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) a{color:inherit;text-decoration:none;background:linear-gradient(transparent,transparent 50%,var(--backgroundLink));padding:0 0.25em;border:var(--borderLink);border-radius:var(--borderRadiusLink);cursor:pointer}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) a:hover{color:var(--textColorHoverLink)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) strong{font-weight:var(--textWeightStrong)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6) em{font-style:--var(textStyleEmphasis)}.wgswgsgy9 .prose>br{margin:0;line-height:0}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>*::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)>*::after{display:inline;color:var(--textColorMarkup);background:var(--backgroundMarkup);font-family:var(--fontCode);line-height:var(--lineHeightMarkup);font-style:var(--textStyleMarkup);border-radius:var(--borderRadiusMarkup);font-size:var(--textSizeMarkup);font-weight:var(--textWeightMarkup);padding:var(--borderRadiusMarkup);vertical-align:0.2em;border:var(--borderMarkup);margin:0 0.1rem}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6)::before,.wgswgsgy9 .prose>*>li::before{display:block;position:absolute;right:100%;top:0.2em;height:1rem;width:1rem}.wgswgsgy9 .prose>ul::before,.wgswgsgy9 .prose>ol::before{display:block;position:absolute;right:100%}.wgswgsgy9 .prose>[data-mark-before]:focus::before{content:attr(data-mark-before)}.wgswgsgy9 .prose>*:focus>li[data-mark-before]{list-style:none}.wgswgsgy9 .prose>*:focus>li[data-mark-before]::before{content:attr(data-mark-before)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus [data-mark-around]::before,.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus [data-mark-around]::after{content:attr(data-mark-around)}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a::before{content:"["}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a::after{content:"]"}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6):focus a[href]::after{content:"]("attr(href)")"}@media print{.wgswgsgy9{break-before:page}.wgswgsgy9 .prose{width:100%;display:flex;flex-direction:column;align-items:center}.wgswgsgy9 .prose>:is(p,ul,ol,h1,h2,h3,h4,h5,h6){max-width:40rem;width:60%}}</style>
<!-- /template -->


</narr-ative>

</main>

<style>.wca28tbqe{--heightViewer: calc(100vh - var(--heightFooter));height:var(--heightViewer);overflow:hidden;position:relative}.wca28tbqe .layout{--render-grid-column: 1;--code-grid-column: 1;--prose-grid-column: 2;display:grid;position:relative;top:calc(var(--heightViewer)*(1 - var(--current-scene, 1)));grid-template-columns:60vw 40vw;grid-auto-rows:calc(0.6*var(--heightViewer)) calc(0.4*var(--heightViewer));grid-auto-flow:column;justify-items:start;transition:top 0.5s ease-in-out;pointer-events:none}.wca28tbqe .layout>*{pointer-events:all}@media print{.wca28tbqe .layout{--prose-grid-row: unset;--render-grid-row: unset;--code-grid-row: unset;position:relative;top:auto;left:auto;height:auto;grid-template-columns:initial;grid-template-rows:initial;grid-auto-columns:initial}.wca28tbqe .layout .render{break-before:page;break-inside:avoid;border:1px dotted black}.wca28tbqe .layout .code{overflow:visible}}</style>

<script>
  customElements.define(
    "consolid-ative",
    class extends HTMLElement {
      connectedCallback() {
        let provider = this.closest("[data-provider]");

        if (provider) {
          const { value: currentScene } = provider.observe(
            "current-scene",
            (newValue) => {
              console.log("Setting layout to scene", newValue);
              this.style = `--current-scene: ${newValue}`;
            }
          );

          console.log("Consolid-ative (webc)");
        }
      }
    }
  );
</script>
</consolid-ative>

</article>

<style>
  article {
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    display: flex;
    flex-direction: column-reverse;
  }

  @media print {
    article {
      position: static;
      height: auto;
      width: 100%;
    }
  }
</style>
<!-- /template -->
</st-ative>
<script type="module">

import { mount } from "/_scripts/oper.ative.js";
console.log("Mounting Operative");
const mountpoint = document.getElementById("lets-be-oper-ative");
const initial = {"who_am_i":"Reactive Programming","author":"The Unbundled Dev","copyright_year":2023,"page_views":9999,"toolbox":{"available":["Rectangle","Triangle","Circle","Polygon","Line","Path","Text"],"selected":"Rectangle","current_index":0},"features":{"fp-moorea":{"feature_name":"Moorea","feature_type":"island","country":"French Polynesia","currency":{"full_name":"French Polynesian Franc","abbrev":"FRP"},"budget":{"hotel_nightly":100,"breakfast":10,"lunch":20,"dinner":40},"climate":"tropical","ratings":{"star_1":0,"star_2":1,"star_3":5,"star_4":30,"star_5":95}}}};
const moduleNames = ["Kram_d693e88c_reactive"];
moduleNames.forEach((name) => mount(name, mountpoint, initial));

</script>


</body>
</html>